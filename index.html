<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Singapore 2023 Population Map</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    svg {
      width: 100%;
      height: 100%;
    }
    h1 {
      margin-bottom: 0;
    }
    /* For the legend display */
    .legend {
      width: 400px;
      height: 20px;
      margin-top: 20px;
      background: linear-gradient(to right, #80dfc8, #f076ba, #5e409e); /* Green to Pink to Purple gradient */
    }
    .legend-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .legend-text {
      display: flex;
      justify-content: space-between;
      width: 400px;
      font-size: 12px;
      margin-top: 5px;
    }
  </style>
</head>
<body>

  <h1>Singapore 2023 Population Map3.0</h1>
  <div class="legend-container">
    <div class="legend"></div>
  </div>
  <div class="legend-text">
    <span>0</span><span>20000</span><span>40000</span><span>60000</span><span>80000</span> <!-- Adjust based on population range -->
  </div>
  <svg></svg>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    let width = 1000, height = 600;

    let svg = d3.select("svg")
        .attr("viewBox", "0 0 " + width + " " + height);

    // Load external data and boot
    Promise.all([d3.json("sgmap.json"), d3.csv("population2023.csv")]).then(data => {
      
      let mapData = data[0].features;
      let popData = data[1];

      // Merge pop data with map data
      mapData.forEach(d => {
        let subzone = popData.find(e => e.Subzone.toUpperCase() == d.properties.Name);
        d.popdata = (subzone != undefined) ? parseInt(subzone.Population) : 0;
      });

      // Map and projection
      let projection = d3.geoMercator()
          .center([103.851959, 1.290270])  // New Singapore Coordinates
          .fitExtent([[20, 20], [980, 580]], data[0]);

      let geopath = d3.geoPath().projection(projection);

      // Color scale based on population (green to pink to purple)
      let colorScale = d3.scaleLinear()
          .domain([0, d3.max(mapData, d => d.popdata)])   // Data range
          .range(["#80dfc8", "#f076ba", "#5e409e"]);  // Green to Pink to Purple

      svg.append("g")
          .attr("id", "districts")
          .selectAll("path")
          .data(mapData)
          .enter()
          .append("path")
          .attr("d", geopath)
          .attr("stroke", "black")
          .attr("stroke-width", 0.5)
          .attr("fill", d => colorScale(d.popdata)) // Apply color based on population
          .on("mouseover", function(event, d) {
            d3.select(this).attr("stroke", "#000").attr("stroke-width", 2);
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(d.properties.Name + "<br>Population: " + d.popdata)
                   .style("left", (event.pageX + 5) + "px")
                   .style("top", (event.pageY - 28) + "px");
          })
          .on("mouseout", function() {
            d3.select(this).attr("stroke", "#fff").attr("stroke-width", 0.5);
            tooltip.transition().duration(500).style("opacity", 0);
          });

      // Tooltip for interactivity
      let tooltip = d3.select("body").append("div")
                      .attr("class", "tooltip")
                      .style("position", "absolute")
                      .style("padding", "10px")
                      .style("background-color", "rgba(0,0,0,0.7)")
                      .style("color", "white")
                      .style("border-radius", "5px")
                      .style("opacity", 0);

      // Create gradient legend
      let legend = d3.select(".legend");

      // Create a linear gradient scale for the legend
      legend.style("background", colorScale(0));

    });

  </script>

</body>
</html>
